import React, { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { getQueryFn } from '@/lib/queryClient';
import { Card } from '@shared/schema';
import { Button } from '@/components/ui/button';
import { Card as CardUI, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Loader2, Plus, CreditCard } from 'lucide-react';
import AddCardModal from './AddCardModal';

function getCardLogoSvg(cardType: string) {
  switch (cardType.toUpperCase()) {
    case 'VISA':
      return (
        <svg viewBox="0 0 750 471" className="h-10 w-16" xmlns="http://www.w3.org/2000/svg">
          <g fill="none">
            <path fill="#0E4595" d="M278.2 334.2h-52.7L255.2 138h52.7l-29.7 196.2" />
            <path d="M524.8 142.8A103.4 103.4 0 0 0 481.5 132C437 132 375 156.7 375 199c0 41.6 44.1 53.1 66 61.7 20.2 8.5 24.2 16 23.8 23.5-.7 12.7-21.4 18.5-41.2 18.7-28.8.2-49.8-6.4-66-14.7L347.2 334c16 7.4 46.3 13.7 77.4 14 73 0 120.8-24 121.2-78 .3-59.6-84-62.8-83.3-89.4.3-8 10-16.7 31.3-19 10.6-1 39.6-1.5 72.5 13.7l10.5-46.6" fill="#0E4595" />
            <path fill="#F2AE14" d="M661.5 138h-48.5c-15 0-26.3 4.2-33 19.2L487.6 334.2h60.6l13-35.8h77.6l7.3 35.8h53.4L661.5 138m-81 124.3l32.4-83.8 18 83.8h-50.3" />
            <path d="M246.5 138L192 272l-5.8-28.7c-9.8-33-40.6-68.5-75-86.4l48.4 176.4h61.3L298.7 138h-52.2" fill="#0E4595" />
            <path d="M121 138H36.4l-.7 3.4c66 16 109.3 55 127.4 101.6L147.2 157c-3.7-14.3-14.5-19-26.2-19" fill="#F2AE14" />
          </g>
        </svg>
      );
    case 'MASTERCARD':
      return (
        <svg viewBox="0 0 750 471" className="h-10 w-16" xmlns="http://www.w3.org/2000/svg">
          <g fill="none">
            <path d="M434.008 236.9c0 99.415-80.634 179.945-180.162 179.945-99.535 0-180.168-80.53-180.168-179.945 0-99.413 80.633-179.95 180.168-179.95 99.528 0 180.162 80.538 180.162 179.95" fill="#D9222A" />
            <path d="M615.01 428.66v-5.712h1.425v-1.16h-4.078v1.16h1.442v5.712h1.21zm6.464 0v-6.872h-1.526l-1.775 4.5-1.775-4.5h-1.52v6.872h1.124v-5.203l1.667 4.017h1.012l1.667-4.017v5.204h1.127z" fill="#000" />
            <path d="M660 236.9c0 99.415-80.635 179.945-180.17 179.945a179.55 179.55 0 0 1-106.158-34.465A180.417 180.417 0 0 0 480 236.9c0-63.78-33.06-119.774-82.834-151.476A179.562 179.562 0 0 1 479.824 57c99.54-.001 180.176 80.536 180.176 179.9" fill="#0097DF" />
            <path d="M363.19 350.885v-6.135h-12.304v-10.82h-6.984l-9.13 16.955h16.114zm-12.304 0v-2.965h6.172l-1.348 2.965h-4.824zm-67.264-6.135h19.585v-12.304h-30.15c-5.693 0-10.296 4.585-10.296 10.276 0 5.968 4.37 10.63 10.273 10.63 3.037 0 5.786-1.258 7.75-3.282l4.17 3.74c-3.36 3.71-8.214 6.026-13.387 6.026-10.044 0-18.165-8.12-18.165-18.165 0-9.762 7.934-17.716 17.698-17.716h37.13v26.838h-6.46v-6.043h-18.15v12.304h6.31a24.57 24.57 0 0 1-4.13 6.135H258.73v-6.135h6.31c4.18-3.743 6.826-9.188 6.826-15.263 0-11.292-9.186-20.48-20.48-20.48h-38.146v41.876h31.232v-6.135h-24.078v-11.846h24.078v-6.136h-24.078v-11.622h24.078v-6.136h-30L225 334.8h-10.887L203.64 304.54h-7.968l13.653 39.37h-6.33v6.135h55.633v.84h6.462v-.84h19.24zm-3.053-12.304h-9.547c.656-5.175 5.1-9.187 10.468-9.187 5.754 0 10.42 4.666 10.42 10.418 0 1.13-.18 2.214-.51 3.234l-5.82-5.226a6.17 6.17 0 0 0-5.01 .76zm19.585 0h-1.95a6.15 6.15 0 0 0 .766-3.006c0-3.44-2.79-6.23-6.23-6.23-3.392 0-6.153 2.707-6.228 6.07l6.688 6.003c.57.512 1.303.78 2.048.78h4.907v-3.616zm87.3 18.44h30.78v-6.136h-23.625v-11.846h23.624v-6.135h-23.626v-11.623h23.624v-6.135h-30.78v41.876zm-38.147 0h6.983v-35.74h14.14v-6.136h-35.264v6.135h14.14v35.74zm-107.953-35.74h17.717v-6.135h-24.87v41.876h7.153v-35.74zm263.123 0h10.476v-6.135h-17.63v41.876h7.153v-35.74z" fill="#fff" />
          </g>
        </svg>
      );
    case 'AMEX':
      return (
        <svg viewBox="0 0 750 471" className="h-10 w-16" xmlns="http://www.w3.org/2000/svg">
          <g fill="none">
            <path d="M41.533 250.225l.7-7.648.63-7.003.588-6.377L40.9 260.934l-19.91.06-13.897-31.688-.578 6.17-.63 6.8-.7 7.56-.782 8.276h-4.44V220.82h8.19l17.47 39.902 17.37-39.903h7.76v40.114h-4.44l-.79-8.276v-2.433zm27.97-14.405v-14.968h21.24v4.588h-16.8v10.38h-4.44zm0 22.713V243.57h20.69v14.963H64.06v-4.588h16.802v-10.38H64.062v-4.587H85.3v9.555H69.503zm48.573 0h-4.442v-40.114h4.442v40.114zm32.18-13.158v-4.586h16.803v-10.38h-16.802v-4.588h20.69v14.968h-16.248v9.555h16.247v-4.588h-16.248v-4.968h20.69v14.966h-25.132zm85.433-31.325h7.76l-17.37 39.902 17.47-39.903h8.19v40.114h-4.44l-.782-8.275-.7-7.56-.63-6.8-.578-6.17-13.895 31.687-19.91-.06-2.55-31.735.587 6.376.63 7.002.7 7.65.79 8.275h-4.442V220.82h7.76l17.37 39.902 17.47-39.903h8.19v40.114h-4.442l-.79-8.276-.7-7.56-.63-6.8-.578-6.17-13.895 31.687-19.91-.06-2.548-31.736.587 6.377.63 7.002.7 7.648.79 8.277h-4.44V220.82zm50.19 13.158h21.24v14.966h-25.133v-40.113h25.133v14.968h-16.8v10.38h16.8v4.586h-21.24v-4.588zm54.07 18.158h-4.443v-40.114h4.442v40.114zm32.18-13.158v-4.586h16.802v-10.38h-16.803v-4.588h20.692v14.968h-16.25v9.555h16.25v-4.588h-16.25v-4.968h20.693v14.966h-25.134zm49.35 13.158h-4.44v-40.114h4.44v40.114zm32.19-18.158h16.8v4.586h-16.8v13.572h-4.44v-40.113h25.13v4.587h-20.69v17.368zm46.97 0h16.802v4.587h-16.8v13.57h-4.442v-40.113h25.133v4.588h-20.69v17.37zm27.968 22.713V243.57h20.69v14.963h-25.13v-4.588h16.8v-10.38h-16.8v-4.587h21.24v9.555h-15.798v4.967h15.8v4.587h-21.24zm49.35-18.158h16.802v18.158h-4.44V243.57h-16.803v-4.588h21.242v9.555h-16.8zm-587.83 3.793V260.934H0v-40.113h5.72c2.53 0 4.39.06 5.592.18 1.177.12 2.333.51 3.47 1.17a11.913 11.913 0 0 1 4.498 4.527c1.13 1.92 1.696 4.11 1.696 6.56 0 5.17-2.282 8.812-6.848 10.93 1.13 1.62 2.322 3.48 3.58 5.588 1.257 2.11 2.568 4.528 3.932 7.26h-5.72l-2.352-4.107c-.97-1.68-1.882-3.18-2.736-4.497-.854-1.318-1.646-2.478-2.376-3.478a16.702 16.702 0 0 0-2.304-2.523c-.746-.66-1.52-1.17-2.322-1.528-.803-.36-1.677-.59-2.623-.69-.947-.09-2.04-.15-3.278-.15H4.443zm0-4.586V228.47c1.79 0 3.17-.03 4.14-.09.97-.06 1.9-.24 2.793-.54.894-.3 1.65-.75 2.266-1.35.618-.6 1.107-1.38 1.476-2.34.366-.96.55-2.1.55-3.42 0-1.32-.194-2.49-.58-3.51-.39-1.02-.912-1.83-1.565-2.43-.658-.6-1.443-1.02-2.352-1.26-.913-.24-2.006-.36-3.277-.36H4.442zm250.404 17.4h-22.12l-5.02 7.26h-5.166l20.963-29.973 19.912 29.973h-5.166l-3.403-7.26zm-2.79-4.5l-8.212-12.36-7.98 12.36h16.193zm190.34 4.5h-22.12l-5.02 7.26h-5.166l20.962-29.973 19.91 29.973h-5.165l-3.402-7.26zm-2.79-4.5l-8.212-12.36-7.98 12.36h16.192zm69.57-17.4V228.47c1.79 0 3.168-.03 4.138-.09.97-.06 1.9-.24 2.794-.54.893-.3 1.65-.75 2.267-1.35.617-.6 1.107-1.38 1.476-2.34.366-.96.55-2.1.55-3.42 0-1.32-.195-2.49-.58-3.51-.39-1.02-.913-1.83-1.566-2.43-.658-.6-1.443-1.02-2.352-1.26-.912-.24-2.006-.36-3.277-.36h-3.45zm0 4.586V260.934h-4.443v-40.113h5.72c2.53 0 4.39.06 5.593.18 1.177.12 2.332.51 3.47 1.17a11.913 11.913 0 0 1 4.498 4.527c1.13 1.92 1.697 4.11 1.697 6.56 0 5.17-2.283 8.812-6.85 10.93 1.13 1.62 2.325 3.48 3.58 5.588 1.257 2.11 2.57 4.528 3.934 7.26h-5.72l-2.352-4.107c-.97-1.68-1.882-3.18-2.736-4.497-.855-1.318-1.647-2.478-2.377-3.478a16.702 16.702 0 0 0-2.304-2.523c-.745-.66-1.52-1.17-2.322-1.528-.802-.36-1.676-.59-2.623-.69-.947-.09-2.04-.15-3.277-.15h-3.487zm250.4-9.555v-14.968h21.24v4.588h-16.8v10.38h-4.44zm.003 22.713V243.57h20.69v14.963h-25.13v-4.588h16.8v-10.38h-16.8v-4.587h21.24v9.555h-15.8v4.967h15.8v4.587h-21.24z" fill="#2557D6" />
            <path d="M711.462 124.035v37.11h37.073V124.037h21.698V86.306h-21.698V48.58H711.17l-.324 37.726h-37.4v36.856l38.017.872zm-25.43-37.73l19.853-.323-19.522-36.21v36.533h-.333zm52.515 9.68h-37.71l27.92 27L711.462 160.5v.646h37.073v-37.11h-37.073l27.372-28.056-19.853-37.728L748.536 86h.31l-10.3 9.986zm-52.515-9.345h-33.88v-37.4H630.46v37.4h-30.026V86.64h21.364l-10.02 10.32h18.682V59.872h20.493v37.086h19.852l7.42-10.318h7.76zM540.7 124.035l38.017-37.728h-76.034V86.64h53.38l-53.38 58.38v15.48h59.757v-36.466h-21.74zm-62.5 36.465h58.034L493.85 124.033v36.467h-15.65zm172.6-131.107h21.698v-15.27h-21.698v15.27zm-62.5 121.453l8.736-9.012H578.72V58.998h28.968l8.736-10.32h-59.33v82.834h39.205zM540.7 13.122v15.27h21.697v-15.27H540.7zm41.873-.324v15.594h21.698V12.798h-21.698zM391.97 123.71h21.84l9.704-10.32h-53.38l39.205 46.786h-8.09v.324h74.982V86.31h-21.698v74.488h-35.777l-26.787-37.086zM351.13 59.873h19.518l8.735-10.32h-39.37v95.48h37.726L350.804 86.64H373.2l-22.07-26.767zm164.51 95.157h21.698v-15.27h-21.698v15.27zm-24.082-95.157h20.826l8.736-10.32h-39.37v95.48h37.402l-27.593-58.392h21.363l-21.364-26.768zm-164.51-46.786h21.697v-15.27h-21.698v15.27zm20.868 141.925h21.697v-15.27h-21.698v15.27zm41.883-.313h21.698v-15.27h-21.698v15.27z" fill="#fff" />
            <path d="M0 1h750v470H0z" fill="#016FD0" />
            <path d="M711.462 124.035v37.11h37.073V124.037h21.698V86.306h-21.698V48.58H711.17l-.324 37.726h-37.4v36.856l38.017.872zm-25.43-37.73l19.853-.323-19.522-36.21v36.533h-.333zm52.515 9.68h-37.71l27.92 27L711.462 160.5v.646h37.073v-37.11h-37.073l27.372-28.056-19.853-37.728L748.536 86h.31l-10.3 9.986zm-52.515-9.345h-33.88v-37.4H630.46v37.4h-30.026V86.64h21.364l-10.02 10.32h18.682V59.872h20.493v37.086h19.852l7.42-10.318h7.76zM540.7 124.035l38.017-37.728h-76.034V86.64h53.38l-53.38 58.38v15.48h59.757v-36.466h-21.74zm-62.5 36.465h58.034L493.85 124.033v36.467h-15.65zm172.6-131.107h21.698v-15.27h-21.698v15.27zm-62.5 121.453l8.736-9.012H578.72V58.998h28.968l8.736-10.32h-59.33v82.834h39.205zM540.7 13.122v15.27h21.697v-15.27H540.7zm41.873-.324v15.594h21.698V12.798h-21.698zM391.97 123.71h21.84l9.704-10.32h-53.38l39.205 46.786h-8.09v.324h74.982V86.31h-21.698v74.488h-35.777l-26.787-37.086zM351.13 59.873h19.518l8.735-10.32h-39.37v95.48h37.726L350.804 86.64H373.2l-22.07-26.767zm164.51 95.157h21.698v-15.27h-21.698v15.27zm-24.082-95.157h20.826l8.736-10.32h-39.37v95.48h37.402l-27.593-58.392h21.363l-21.364-26.768zm-164.51-46.786h21.697v-15.27h-21.698v15.27zm20.868 141.925h21.697v-15.27h-21.698v15.27zm41.883-.313h21.698v-15.27h-21.698v15.27z" fill="#fff" />
          </g>
        </svg>
      );
    case 'DISCOVER':
      return (
        <svg viewBox="0 0 750 471" className="h-10 w-16" xmlns="http://www.w3.org/2000/svg">
          <g fill="none">
            <path d="M52.3 21.4h645.6c16.5 0 29.8 13.4 29.8 29.9v367.8c0 16.5-13.3 29.9-29.8 29.9H52.3c-16.5 0-29.8-13.4-29.8-29.9V51.3c0-16.5 13.3-29.9 29.8-29.9z" stroke="#000" strokeWidth="1.1" fill="#fff" />
            <path d="M335.5 230.9c0 34-27.4 61.5-61.5 61.5-33.9 0-61.5-27.6-61.5-61.5s27.6-61.5 61.5-61.5c34 0 61.5 27.5 61.5 61.5" fill="#F47216" />
            <path d="M225.6 196.2v-2.8h-4.5v2.8h4.5m-4.5-1.7h-2.2v-.6h2.2v.6m0 .5h-2.2v-.1h2.2v.1m0 .6h-2.2v-.1h2.2v.1m-2.2.6v-.1h2.2v.1h-2.2m0 .6v-.1h2.2v.1h-2.2m2.2.5h-2.2v-.2h2.2v.2m-2.2.6v-.1h2.2v.1h-2.2m0 .5v-.1h2.2v.1h-2.2m6.6-3.9v4.4h-1.6v-5.5h1.6l2.1 3.4v-3.4h1.6v5.5h-1.5l-2.2-4.4m5-1v5.5h-1.7v-5.5h1.7m4.8 0l-1.9 4-1.9-4h-1.8l2.8 5.5h1.7l2.8-5.5h-1.7m3 0v5.5h-1.6v-5.5h1.6m17 0v5.5h-2.2c-1.2 0-2-.4-2.5-1.3-.4-.7-.6-1.4-.6-2.3 0-1.4.4-2.4 1.1-3 .5-.4 1.3-.6 2.3-.6h1.8m-3.1 3.2c0 .8.3 1.3.7 1.6.3.2.5.2 1 .2h.8v-3.6h-.7c-.6 0-1 .1-1.3.5-.2.4-.5.8-.5 1.3m5 2.3v-5.5h3v1.4h-1.3v.8h1.3v1.3h-1.3v.6h1.3v1.4h-3m3.6-5.5h2.8c1.8 0 2.8 1 2.8 2.7 0 2.2-1 2.8-3.3 2.8h-.6v-4h-1.7v5.5h2.5c1.4 0 2.2-.3 2.8-.9.6-.6 1-1.5 1-2.7 0-1-.2-1.8-.7-2.5-.7-.8-1.8-1-3.2-1h-3.2v.1m8.2 0v5.5h3v-1.4h-1.3v-4h-1.7m3.3-3.8v2h-1.6v-2h1.7m-1.6 3.8h1.6v5.5h-1.6v-5.5m4.8 0l-2.4 5.5h1.6l.5-1.3h2.3l.5 1.3h1.7l-2.4-5.5h-1.8m-.1 3l.7-1.8.7 1.8h-1.4m7 2.5v-5.5h-1.6v3.8l-2.2-3.8h-1.6v5.5h1.6v-4l2.2 4h1.5m2.6-5.5v5.5h-1.7v-5.5h1.7m-1.7-1.8v-2h1.7v2h-1.7m9.4 5.6c-.4.2-.3.2-1 .2-.5 0-.8-.1-1.1-.2-1-.6-1.5-1.5-1.5-2.8 0-1.6.7-2.8 2-3.3.4-.2.7-.2 1.1-.2.4 0 .8 0 1 .2v1.7c-.5-.4-.8-.6-1.3-.6-1 0-1.5.7-1.5 2 0 1.2.5 2 1.4 2 .6 0 1-.3 1.5-.6v1.5l.4.1m4.6 1.7h-2.3c-1.4 0-2.1-.8-2.1-2.3v-5h1.7v5c0 .4.2.7.7.7h.4v-5.6h1.6v7.2m.2-7.3h1.7l.4 4 1.3-4h1.6l-2.2 5.5h-1.5l-.6-4-1.2 4h-1.6l-2.2-5.5h1.7l1.3 4 .3-4m10.8 3h-3.2c0 .8.4 1.2 1.2 1.2.6 0 1-.2 1.5-.5v1.3c-.5.2-1 .3-1.7.3-1.5 0-2.4-.8-2.4-2.4 0-1.6 1-2.6 2.5-2.6 1.4 0 2.2.9 2.2 2.2 0 .1 0 .3-.1.6m-3.2-.9h1.6c0-.6-.2-.9-.7-.9-.6 0-.9.3-.9.9m4.8-1.7v.8c.5-.6 1-.9 1.7-.9 1 0 1.7.5 1.7 1.3V196.7c-.6-.4-1-.5-1.5-.5-.8 0-1.3.5-1.3 1.4 0 1 .5 1.6 1.4 1.6.5 0 .9-.2 1.4-.6v.5h1.6v-4c0-1.5-1-2.4-2.4-2.4-.8 0-1.4.1-2.6.7m3.4 3.3c0-.4-.3-.7-.8-.7s-.8.3-.8.7.3.6.8.6.8-.3.8-.6m5.7-2.4v-1h-1.2v-1.2l-1.6.5v.7h-.7v1h.7v2.4c0 1.2.5 1.6 2 1.6.3 0 .5 0 .8-.1v-1.1h-.4c-.5 0-.7-.1-.7-.6v-2.1l1.1-.1m4.7 2.5h-1c-.2.2-.3.4-.3.6 0 .2.2.4.6.4.4 0 .7-.3.7-.6v-.4zm-2.3-2.3c.7-.5 1.4-.7 2.2-.7 1.4 0 2 .5 2 1.7v3.3h-1.7v-.6c-.4.5-.8.7-1.4.7-1 0-1.7-.6-1.7-1.5 0-1.1.8-1.7 2.4-1.7h.7v-.3c0-.3-.3-.5-.8-.5-.6 0-1.1.2-1.7.6v-1m7.4 3c-.5 0-.7-.1-.7-.5 0-.3.3-.5.7-.5h1.6v.5c0 .3-.5.5-1.6.5m.1-3.8c1 0 1.4.3 1.4.9 0 .4-.2.7-.5.8-.3.1-.8.1-1.5.1-.5.1-.8.2-.8.5s.3.5.9.5c.6 0 1-.2 1.5-.5v1.3c-.5.2-1 .3-1.7.3-1.5 0-2.4-.6-2.4-1.5 0-.7.5-1.2 1.2-1.4-.5-.2-.7-.5-.7-.9 0-.8.8-1.2 2.6-1.1m-2.4-1c0-.3.3-.6.6-.6.4 0 .6.3.6.6 0 .4-.2.6-.6.6-.3 0-.6-.2-.6-.6m2.9 0c0-.3.3-.6.6-.6.3 0 .6.3.6.6 0 .4-.3.6-.6.6-.3 0-.6-.2-.6-.6m9.2 3.7c-.5 0-.8-.5-.8-1.2 0-.8.3-1.2.8-1.2.6 0 .9.4.9 1.2 0 .7-.3 1.2-.9 1.2m0-3.6c-1.5 0-2.5 1-2.5 2.4s1 2.5 2.5 2.5 2.4-1 2.4-2.5c0-1.4-1-2.4-2.4-2.4m5.5.2v.9c.4-.7.8-.9 1.6-.9v1.7h-.4c-.4 0-.7 0-.9.2-.2.2-.3.4-.3.8v2.8h-1.6v-5.5h1.6m2 0h1.6v5.5h-1.6v-5.5m0-1.8h1.6v1.3h-1.6v-1.3m5.8 1.8l-1.8 5.5h-1.9l-1.7-5.5h1.7l.9 3.7.9-3.7h1.9m.5-1.8h1.6v1.3h-1.6v-1.3m0 1.8h1.6v5.5h-1.6v-5.5m7.3 0v5.5h-1.7v-.6c-.4.5-.9.8-1.5.8-.7 0-1.2-.3-1.5-.8-.2-.4-.3-.9-.3-1.7v-3.2h1.6V194c0 .5 0 .8.2 1 .1.2.4.3.7.3.4 0 .6-.1.8-.4.2-.2.2-.5.2-1v-2.9h1.5m3 0l-1.7 2.4 1.8 3.1h-1.9l-1-1.8-.2.3v1.6h-1.6v-7.5h1.6v4l1.5-2h1.5m5.5 3h-3.2c0 .8.4 1.2 1.2 1.2.6 0 1-.2 1.5-.5v1.3c-.5.2-1 .3-1.7.3-1.5 0-2.4-.8-2.4-2.4 0-1.6 1-2.6 2.5-2.6 1.4 0 2.2.9 2.2 2.2 0 .1 0 .3-.1.6m-3.2-.9h1.6c0-.6-.2-.9-.7-.9-.6 0-.9.3-.9.9m7.9 3.5v-7.5h2.2c2.1 0 3.3 1.3 3.3 3.8 0 1.2-.4 2.2-1 2.8-.6.6-1.4.9-2.5.9h-2zm1.7-6.2v4.9h.6c.6 0 1-.2 1.3-.6.3-.4.5-1 .5-1.9 0-1.7-.6-2.5-1.8-2.5l-.6.1z" />
            <path d="M52.8 377.6V84.2c96.7-32.4 204-50.9 311.8-50.9 106.1 0 210.7 18.6 311.9 50.9v293.4H52.8zm246.1-183.7c0-69.1 50.6-118.8 120.3-118.8 36.5 0 66.4 10.7 97.2 37.2l-24.5 29.8c-21.4-19.1-40.5-28.2-74.5-28.2-50.6 0-84.6 35.6-84.6 80 0 45.9 34 80 84.6 80 24.5 0 43.7-4.6 62.8-16.8v-60.6h-73.7v-33h107.7v113.6c-26.1 22.2-65.5 36.1-101.2 36.1-69.8-.1-114.1-50.7-114.1-119.3zm-205 117.9l13-31.4h80l13 31.4h40.5l-77.7-177.1h-33.1l-77.7 177.1h42zm52.9-127.7l29.1 67.9h-58.2l29.1-67.9zm445.6 11.5h-73.6V144h73.6v51.6zm5.4 116.2l13-31.4h80l13 31.4h40.5l-77.7-177.1h-33.1l-77.7 177.1h42zm52.9-127.8l29.1 67.9h-58.3l29.2-67.9z" fill="#F47216" />
          </g>
        </svg>
      );
    default:
      return <CreditCard className="h-10 w-16 text-gray-400" />;
  }
}

export default function PaymentMethods() {
  const [isAddCardModalOpen, setIsAddCardModalOpen] = useState(false);
  
  const { data: cards, isLoading } = useQuery<Card[]>({
    queryKey: ['/api/cards'],
    queryFn: getQueryFn({ on401: 'returnNull' }),
  });

  const handleAddCard = () => {
    setIsAddCardModalOpen(true);
  };

  const renderCardItem = (card: Card) => {
    return (
      <CardUI key={card.id} className="overflow-hidden">
        <CardContent className="p-0">
          <div className="p-6 flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div>
                {getCardLogoSvg(card.cardType)}
              </div>
              <div>
                <h3 className="font-medium">•••• •••• •••• {card.last4}</h3>
                <p className="text-sm text-gray-500">
                  Expires {card.expiryMonth}/{card.expiryYear}
                </p>
                <p className="text-sm text-gray-500">{card.cardholderName}</p>
              </div>
            </div>
            {card.isDefault && (
              <div className="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">
                Default
              </div>
            )}
          </div>
        </CardContent>
      </CardUI>
    );
  };

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h2 className="text-lg font-semibold text-gray-900">Payment Methods</h2>
        <Button variant="outline" onClick={handleAddCard} className="gap-2">
          <Plus className="h-4 w-4" />
          Add Payment Method
        </Button>
      </div>

      {isLoading ? (
        <div className="flex justify-center py-8">
          <Loader2 className="h-8 w-8 animate-spin text-primary" />
        </div>
      ) : (
        <div className="grid grid-cols-1 gap-4">
          {cards && cards.length > 0 ? (
            cards.map(card => renderCardItem(card))
          ) : (
            <CardUI>
              <CardContent className="py-8 flex flex-col items-center justify-center">
                <CreditCard className="h-12 w-12 text-gray-400 mb-4" />
                <h3 className="text-lg font-medium text-gray-900">No Payment Methods</h3>
                <p className="text-gray-500 mt-1 text-center max-w-md">
                  You haven't added any payment methods yet. Add a payment method to use for deposits and withdrawals.
                </p>
                <Button onClick={handleAddCard} className="mt-4 gap-2">
                  <Plus className="h-4 w-4" />
                  Add Payment Method
                </Button>
              </CardContent>
            </CardUI>
          )}
        </div>
      )}

      <AddCardModal 
        isOpen={isAddCardModalOpen} 
        onClose={() => setIsAddCardModalOpen(false)} 
      />
    </div>
  );
}